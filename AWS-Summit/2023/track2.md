# 삼성전자/쿠팡의 대규모 트래픽 처리를 위한 클라우드 네이티브 데이터베이스 활용

김영진 솔류션즈 아케텍트, aws

김티나 DBA, Coupang

권용석 프로, 삼성전자

---

Agenda

1. 현대 어플리케이션의 특징
2. 특별히 구축된 AWS 데이터베이스 - 올바른 작업에 적합한 도구
3. 삼성전자의 선택 “Shared repository architecture style” 디자인 전략
4. 대용량 트래픽, 쿠팡의 DB엔지니어가 클라우드를 사용하는 방법

## 현재 어플리케이션의 특징

어플리케이션의 복잡성이 올라감에 따라 하나의 데이터베이스에 처리하지 않는다.

하나의 엔드포인트를 통해서 접근권한에따른 DB를 따로 가져가기도 한다.

다양한 플랫폼에서 데이터를 처리한다.

⇒ 하나의 데이터베이스를 가지고 처리하는것은 매우 어렵다.

⇒ 직접 관리하는 것에 매우 어려움 (비용, 인력, 패치, 성능, 보안 등등)

## 자체 데이터베이스 관리 및 분석의 어려움

## 목적에 맞는 데이터베이스

## 특별히 구축된 AWS 데이터베이스

다양한 데이터베이스 선택

Neptune: 사용자와의 관계

---

# Shared repository architecture style Design Strategy

삼성전자 사례

## Rich Communication Service

차세대 메시지 플랫폼

- 49,000,000 개인 메시지 / 일
- 31,000,000 사용자
- 38,000,000 기업 메시지 / 일

갤럭시 핸드폰에 기본 탑재된 어플리케이션이기 때문에 같이 성장

## 배경

RCS 1.0 마이그레이션 (2019)

- Lift and Shift 전환
- 모놀리식 아키텍처
- 클러스터당 1,000,000명의 사용자
- 각 사업자에 대해 10~20개의 클러스터
- 클러스터에 한번 할당된 사용자는 다른 클러스터로 변환 불가

RCS 2.0 (2022)

- 재설계/구현
- 마이크로 서비스 아키텍처
- 하위 도메인으로 분리
- Issue : “데이터 의존성” 분리

## 공유 저장소 아케틱처 Shared Repository Architecture Style

Issue: 정합성 & 성능

데이터의 성질에 따라 정합성이 중요할 수도 성능이 중요할 수 도 있었다.

두가지 케이스에 대해서 어떠한 설계안을 선정하게 됐는지 발표

## 챗볼 브랜드 정보 제공 서비스

(읽기 성능 품질 요구가 최우선)

- 도메인 성격
    
    매우 많은 읽기, 매우 적은 쓰기
    
    데이터 정합성을 조금 부족해도 감안할 수 있다.
    
- 서비스 성격
    
    높은 읽기 성능 품질 요구 (응답시간)
    
    클라이언트 Cache가 구현되어 있음
    
- 챗봇은 데이터의 변경이 빈번하게 이뤄지지 않는다. ⇒ Aurora
- 하지만 성능 품질을 획득하지 못함
    
    ⇒ Aurora ElasticCache
    
    - 키 이벤트 구독을 통해서 특정데이터가 변경돼었다는 것을 알려주는 것을 이용해서 데이터 정합성 문제를 해결

## 가입자 연결 정보 제공 서비스

(정합성 품질 요구가 최우선인 경우)

- 도메인 성격
    
    Handover, Wifi 전환 등 이동통신단말의 잦은 주소 변경
    
- 서비스 성격
    
    메시지 누락, 오 전송에 매우 민감
    
    연결 정보 획득 성능이 메시지 송신 성능에 영향을 줌
    
- A의 변경사항을 B에게 적용하지 못한다는 것은 재앙과 같은 일
- 다이나모DB와 엘라스틱 캐시, 테이터 프로바이더 서비스
- 설계단계에서 원하는 요구사항을 만족시키는 방향으로 진행해야 한다.

## 효과

- 성능
    
    개인 메시지 - 5배 향상
    
    기업 메시지 - 10배 향상
    
- 비용
    
    30% 절감
    
- 장애
    
    장애 발생율 RCS1.0 대비 13%
    
- 목적에 맞는 Managed Service와 도메인 특성을 반영한 전략이 결합되어 견고한 서비스를 만든다.
- 이전 세대의 개발자들은 RDBMS의 성능을 향상시키기 위해 많은 시간과 노력이 소요됐다.
- 하지만 우리 세대는 이런 여러 준비됀 도구들을 사용해서 급진적인 서비스를 만들 수 있게됐다.

# 

### 쿠팡의 마이크로 서비스 아키텍처 MSA

서비스간의 역할을 분리하여 영향도를 최소화 시킨 아키텍처

하나의 노드가 수용할 수 있는 트래픽은 한정

대표적인 예로 쿠팡의 물류센터 호가장

## DML, DDl, ACL 작업 요청 증가 추세

서비스 크기 증가에 따라 데이터베이스 작업 증가

쿠팡의 경우 RDS는 3배의 크기를 갖게 됨

## 스마트 지원 서비스

서비스의 영향은 최소화, 직접 데이터베이스에 요청 생성 & 자동으로 요청 수행

인력을 아낄 수 있었다.

## 스마트 지원 서비스를 개발하기 위한 조건

- 실시간으로 클러스트에 최신의 서버 구성 정보를 사용자에게 제공해야한다.
- 장애에 적극적인 대응
    - 예측 가능한 장애에 대한 프로세스 준비해야함
- 커뮤니케이션 최소화
    - 가장 많은 비용이 소요가 돼었다.
    - 가장 많이 받은 질문이 스마트 지원서비스가 무엇인가?

## 스마트 지원 서비스 예제 - DML 작업 수행

- 모든 데이터베이스 작업은 DBMA를 통해서 작업을 처리 ( 매달 4~500건의 요청을 수행)
- 직접 사람이 처리했었음
    - 작업을 위한 요구사항을 정리하는것에 더 많은 시간 소요
    - 누락, 오타 등 많이 발생
- DML을 넣게되면 일련의 과정이 자동으로 처리

## 스마트 지원 서비스 예제 - DDL 작업 수행

- 한달에 약 300건의 요청을 수행
- 데이터베이스의 작업을 위한 커뮤니케이션을 통해 처리
    - 요청날에 모니터링하에 DDL을 수행
    - 최소한 이틀이상의 시간이 소요
    - 대용량의 DB를 변경할때 데이터베이스의 엔지니어의 필요도가 너무나도 급증
- 한번에 한건만 처리
- DDL의 목적및 asis 스키마
- 템플리화를 통해 오류를 많이 줄일 수 있었음.
- DDL에 대한 유효성을 Validation서버를 통해서 체크 후 적용
- 요청에 대한 요약을 통해서 마지막으로 확인
- 테이블의 기존의 히스토리를 확인가능
- 마지막으로 스케줄러에 등록하고 원하는 시간에 DDL을 수행

## 서비스 안정화 방법들

## 쿠팡의 블루/그린 서비스

- 50%이상의 RDBMS가 블루그린 서비스를 통해서 처리

## 쿠팡의 블루/그린 서비스-클러스터 전환 전

핵심은 데이터베이스 컨트롤러

컨트롤러가 다양한 작업을 진행함

## 쿠팡의 블루/그린 서비스-클러스터 전환 후

전환 후에는 그린에서 블루로 역 동기화가 생겼다.

최근 AWS에서도 블루/그린 서비스를 런칭했다.

쿠팡에서도 내부테스트를 완료하였고 서비스 런칭을 하기 위해 준비중이다.

## 고려할 요소
