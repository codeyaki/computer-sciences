# 천만 사용자를 위한 카카오의 AWS Native 글로벌 채팅 서비스

김영욱 솔루션즈 아키텍트, AWS

Walter Kim 실장, Kakao

---

글로벌 서비스에서 발생하는 문제를 해결하는 과정 공유

슈퍼앱 카카오톡과는 관련없음

## Agenda

1. 글로벌 채팅 서비스 요구사항과 구축 전략
2. 카카오의 글로벌 채팅 서비스 구축사례
3. 마무리

---

## 글로벌 채팅 서비스 요구사항과 구축 전략

요구사하오가 전략

- 글로벌 서비스 출시
- 중요한 것에 집중하기
    - 새로운 시도를 많은 사람을 이용해서 엄청난 준비끝에 바로 시도하기엔 어려움. 소수의 인원으로 가능한지 확인해야 했음 ⇒ 중요한것에 집중
- 빠르고 바른 의사 결정
    - 정말 이게 될까? 라는 고민이 있었음

### 전략

1. 글로벌 인프라스트럭처
    
2. 서버리스
    - 운영 구단이 적은 서비스
    - 실제 물리적인 서버는 있지만 운영, 유지보수 등 관리는 AWS에서 담당
3. 프로토타이핑
    1. 이것이 될까? 판단 기준을 수립하기 위해 프로토타입 

- 글로벌 네트워크
- Direct Connect

## AWS Lambda

서버리스 컴퓨팅

- 이벤트 소스
    - 데이터 변경들
    - 엔드 포인트를 통한 요청들
    - 자원 상태 변경들
- 서비스 / 그 외

람다에서 어떠한 정보를 넣을때 index인 이메일만 안다면 그를 기준으로 작업

# part2

## 관전 포인트

AWS로 구축할 수 있는 채팅의 한계에 대한 호기심

## 발단: 급하게 요청 받은 채팅 서비스 구축

시작은 빈약했으나

채팅서비스를 2명의 적은 인원으로 어떻게 빨리 구현할 수 있을까

## Announcing WebSocket APIs in Amazon API Gateway

## Sample Chatting Architecture - XMPP

전통적인 채팅 서비스 구조이지만 scale-out이 가능한 로드밸런서가 빠져있음

## Simple is the Best

AWS 서비스를 활용하여 관리 포인트 감소

## 예전과는 다른 채팅의 요구사항

- 예전에 중요했던 화두
    - 접속 상태 확인, 메시지 즉시 전달
- 지금 중요한 화두
    - 메시지 보관, 답글 달기, 공지, ‘좋아요’ 달기
    - 참여하기 이전에 발생했던 채팅도 볼 수 있어야 한다

## 기능 제공 전략

- 빠르고 확장 가능한 컴퓨팅
- 빠르게 상태를 업데이트할 수 있는 데이터베이스
- 실시간 갱신 정보를 위한 Pub/Sub

## 구현 전략

안티 패턴 (ANTI-PATTERN) 배제

- 3이전의 설계 경험을 바탕으로 대규모 시스템과 맞지 않는 패턴 사용 자제

AWS 솔루션스 아키텍트 협업

- 프로젝트 초기부터 AWS팀과 협업하여 서비스에 최적화된 솔류션 검토

기술과 기획의 타협

- 엔지니어링 비용과 고객 만족 사이의 적절한 가성비

## 채팅 서비스 구축 결과

서비스 런칭, 성공적

- 아무런 오류 없이 서비스 런칭

드라마틱한 관리 비용 감소

- 맨먼스 (MM) 0에 수렴

요청 쇄도

- 다른 서비스에서도 채팅 적용 요청 급증

## 첫번째 도전: 글로벌 지원해주세요

중국까지

## 서울, 도쿄, 북미 등 여러 리전에 접속한 유저들의 채팅 지원

분석 결과

- 대부분의 트래픽은 리전안에서 발생, 리전을 넘어서 채팅하는 경우도 드물게 발생

아키텍처 개선

- 기존과 동일한 구조사용 리전을 넘는 통신과 글로벌 데이터베이스 동기화 지원

## 글로벌 아키텍처

게이트웨이가 리전간 호환 가능

- Amazon API Gateway

다른 리전의 정보는 API를 통한 접근

- AWS Lambda

리전간 데이터 동기화

- Amazon DynamoDB Global Table

## 중국 지원

중국이란 특이한 환경을 지원하기 위해서 cloudFront를 사용해서 프록시 역할을 부여했다.

다른 서비스의 앞단에 붙어 서비스를 다르게 제공하는것이 가능(타 Cloud 사와 연결)

## 글로벌 확장 결과

간단한 구축

- 이미 구축했던 AWS환경 위에 Route 53 기능 추가

드라마틱한 관리 비용 감소

- 한달넘게 설계, 중국을 지원하기 위한 어려움이 있었지만 관리비용 0에 수렴

용도 확장

- 서비스 런칭 이후 다른 용도로도 활용
- PubNub 서비스가 존재하고 있다는 것을 알게 됨

# 두번째 도전: 카카오에서 서비스를?

대규모 서비스

## 요구사항과 도전 과제

다양한 요구사황과 더불어,

1. 높은 사업 목표
    - 글로벌 사용자
    - DAU 1천만, MAU 1백만 이상
2. 낮은 숙련도
    - AWS Native에 대한 경험 부족

## 문제 해결

8주간 걸쳐서 스프린트

기술 세미나와 스프린트 제로 단계에서 각 단계의 전문가들에게 교육을 받고 숙련도를 올렸음

## 글로벌 아키텍처 개선

인증과 관련된 Cognito

보안과 관련된 WAF

배포와 관련된 CDK

## 결론: 많은 어려움에도 불구하고 Cloud Native의 이유

## AWS를 중심으로 한 핵심 골격을 유지하는 이유

- 코드 기반 운영 자동화
- 소프트웨어 수명 주기 ( 개발 기간 < 운영 기간 )
- 빠른 속도로 요구사항 수용
- 글로벌 지원

## 마무리

AWS로 채팅서비스를 구축한 여정에 대해 말씀

1. 효율성 증가
2. 비용 절감
3. 가용성 보장
